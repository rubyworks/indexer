<html>
<head>
  <title>.ruby</title>

  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

  <script type="text/javascript" src="assets/jquery-1.4.2.min.js"></script>
  <script type="text/javascript" src="assets/underscore-min.js" ></script>
  <script type="text/javascript" src="assets/knockout-2.0.0.js" ></script>

  <style>
    html { margin: 0; padding: 0; }
    body { margin: 0; padding: 0; }
    #main { width: 960px; margin: 0 auto; padding: 10px; text-align: left; }
    table {}
    th { text-align: left; vertical-align: top; padding: 0 0.5em 0 0; font-family: sans-serif; color: #555; }
    td { text-align: left; vertical-align: top; border: 1px solid #ccc; }
    button { font-family: monospace; }
    input { border: none; font-family: monospace; color: #000; }
    textarea { border: none; font-family: monospace; color: #000; width: 99%; }
    .tag { font-family: monospace; background-color: #e9e9e9; padding: 2px; margin: 2px; }
    a.remove { font-family: sans-serif; font-size: 0.8em; text-decoration: none; color: #900; }
  </style>

  <script>
    var dotrubyInstance = null;
    $(document).ready(function(){
      $.getJSON("/dotruby", function(data) { 
        dotrubyInstance = new DotRuby.viewModel(data);  // testData
        ko.applyBindings(dotrubyInstance);
      });
    });
  </script>
</head>
<body>

<div id="main">
  <h1><span data-bind='text: title'></span> (.ruby)</h1>
  <table>
  <tr>
    <th>Name</th>
    <td><input type="text" data-bind='value: name' /></td>
  </tr>
  <tr>
    <th>Version</th>
    <td><input type="text" data-bind='value: version' /></td>
  </tr>
  <tr>
    <th>Codename</th>
    <td><input type="text" data-bind='value: codename' /></td>
  </tr>
  <tr>
    <th>Title</th>
    <td><input type="text" data-bind='value: title' /></td>
  </tr>
  <tr>
    <th>Summary</th>
    <td><input type="text" data-bind='value: summary' /></td>
  </tr>
  <tr>
    <th>Description</th>
    <td><textarea data-bind='value: description'></textarea></td>
  </tr>
  <tr>
    <th>Organization</th>
    <td><input type="text" data-bind='value: organization' /></td>
  </tr>
  <tr>
    <th>Suite</th>
    <td><input type="text" data-bind='value: suite' /></td>
  </tr>
  <tr>
    <th>
      Requirements <br/>
      <button data-bind="click: addRequirement">+</button>
    </th>
    <td>
      <table class='requirementsEditor'>
        <thead>
          <tr> <th>Name</th> <th>Version</th> <th>Dev</th> <th>Groups</th> <th>Engines</th> <th>Platforms</th> </tr>
        </thead>
        <tbody data-bind="template: {name: 'requirementTemplate', foreach: requirements}">
        </tbody>
      </table>
    </td>
  </tr>
  <tr>
    <th>
      Dependencies <br/>
      <button data-bind="click: addDependency">+</button>
    </th>
    <td>
      <table class='dependenciesEditor'>
        <thead>
          <tr> <th>Name</th> <th>Version</th> <th>Dev</th> <th>Groups</th> </tr>
        </thead>
        <tbody data-bind="template: {name: 'dependencyTemplate', foreach: dependencies}">
        </tbody>
      </table>
    </td>
  </tr>
  <tr>
    <th>
      Resources <br/>
      <button data-bind="click: addResource">+</button>
    </th>
    <td>
      <table class='resourcesEditor'>
        <thead>
          <tr> <th>Label</th> <th>URI</th> </tr>
        </thead>
        <tbody data-bind="template: {name: 'resourceTemplate', foreach: resources}">
        </tbody>
      </table>
    </td>
  </tr>
  <tr>
    <th>
      Repositories <br/>
      <button data-bind="click: addRepository">+</button>
    </th>
    <td id='repositoriesList'>
      <table class='repositoriesEditor'>
        <thead>
          <tr> <th>Label</th> <th>URI</th> <th>SCM</th> </tr>
        </thead>
        <tbody data-bind="template: {name: 'repositoryTemplate', foreach: repositories}">
        </tbody>
      </table>
    </td>
  </tr>
  <tr>
    <th>
      Authors <br/>
      <button data-bind="click: addAuthor">+</button>
    </th>
    <td id='authorsList'>
      <table class='authorsEditor'>
        <thead>
          <tr> <th>Name</th> <th>Email</th> <th>Website</th> <th>Roles</th> </tr>
        </thead>
        <tbody data-bind="template: {name: 'authorTemplate', foreach: authors}">
        </tbody>
      </table>
    </td>
  </tr>
  <tr>
    <th>
      Copyrights </br>
      <button data-bind="click: addCopyright">+</button>
    </th>
    <td>
      <table class='repositoriesEditor'>
        <thead>
          <tr> <th>Year</th> <th>Holder</th> <th>License</th> </tr>
        </thead>
        <tbody data-bind="template: {name: 'copyrightTemplate', foreach: copyrights}">
        </tbody>
      </table>
    </td>
  </tr>
  <tr>
    <th>Extra</th>
    <td></td>
  </tr>
  </table>

  <button onclick='save();'>Save to JSON</button> <br/>
  <textarea id='lastSavedJson' rows='5' cols='60' disabled='disabled'> </textarea>

</div>

</body>
</html>

<script id="requirementTemplate" type="text/html">
  <tr>
    <td><input data-bind='value: name' /> </td>
    <td><input data-bind='value: version' /></td>
    <td><input type='checkbox' data-bind='checked: development' /></td>
    <td>
      <span data-bind="foreach: groups">
        <span class="tag">
          <span data-bind='text: $data'> </span>
          <a href="#" list="roles" class="remove">x</a>
        </span>
      </span>
      <button list="groups" class="insert">+</button>
    </td>

    <td>
      <span data-bind="foreach: engines">
        <span class="tag">
          <span data-bind='text: $data'> </span>
          <a href="#" list="engines" class="remove">x</a>
        </span>
      </span>
      <button list="engines" class="insert">+</button>
    </td>

    <td>
      <span data-bind="foreach: platforms">
        <span class="tag">
          <span data-bind='text: $data'> </span>
          <a href="#" list="platforms" class="remove">x</a>
        </span>
      </span>
      <button list="platforms" class="insert">+</button>
    </td>

    <td><button list="requirements" class="remove">x</button></td>
  </tr>
</script>

<script id="dependencyTemplate" type="text/html">
  <tr>
    <td><input data-bind='value: name' /> </td>
    <td><input data-bind='value: version' /></td>
    <td><input type='checkbox' data-bind='checked: development' /></td>
    <td>
      <span data-bind="foreach: groups">
        <span class="tag">
          <span data-bind='text: $data'> </span>
          <a href="#" list="groups" class="remove">x</a>
        </span>
      </span>
      <button list="groups" class="insert">+</button>
    </td>
    <td><button list="requirements" class="remove">x</button></td>
  </tr>
</script>

<script id="resourceTemplate" type="text/html">
  <tr>
    <td><input data-bind='value: label' /></td>
    <td><input data-bind='value: uri' /></td>
    <td><button list="resources" class="remove">x</button></td>
  </tr>
</script>

<script id="repositoryTemplate" type="text/html">
  <tr>
    <td><input data-bind='value: label' /></td>
    <td><input data-bind='value: uri' /></td>
    <td><input data-bind='value: scm' /></td>
    <td><button list="repositories" class='remove'>x</button></td>
  </tr>
</script>

<script id="authorTemplate" type="text/html">
  <tr>
    <td><input data-bind='value: name' /></td>
    <td><input data-bind='value: email' /></td>
    <td><input data-bind='value: website' /></td>
    <td>
      <div data-bind="foreach: roles">
        <span class="tag">
          <span data-bind='text: $data'> </span>
          <a href="#" list="roles" class="remove">x</a>
        </span>
      </div>
      <div>
        <button list="roles" class="insert">+</button>
      </div>
    </td>
    <td>
      <button list="authors" class="remove">x</button>
    </td>
  </tr>
</script>

<script id="copyrightTemplate" type="text/html">
  <tr>
    <td><input data-bind='value: year' /></td>
    <td><input data-bind='value: holder' /></td>
    <td><input data-bind='value: license' /></td>
    <td>
      <button list="copyrights" class="remove">x</button>
    </td>
  </tr>
</script>

<script type="text/javascript" src="assets/dotruby_model.js" ></script>
<script type="text/javascript" src="assets/dotruby_binding.js" ></script>
<script type="text/javascript" src="assets/testdata.json" ></script>

